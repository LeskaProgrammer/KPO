# КПО-ДЗ-2 — отчёт

> `sample.json` — тестовый набор для импорта: много счетов, категорий, операций.

## 1) Паттерны GoF

1. **Facade** — `AccountFacade`, `CategoryFacade`, `OperationFacade`, `AnalyticsFacade`.  
   *Зачем:* единая точка входа для сценариев, UI не знает о внутренних сервисах/репозиториях.

2. **Command** — команды сценариев: `ImportData`, `ExportData`, `RecalculateBalance`, и др.  
   *Зачем:* каждый сценарий = объект с `Execute()`. Удобно вызывать, логировать, декорировать.

3. **Decorator** — `TimedCommand` (обёртка над командой).  
   *Зачем:* измерение времени без правок кода самих команд.

4. **Template Method** — `BaseImporter` → `JsonImporter` / `YamlImporter` / `CsvImporter`.  
   *Зачем:* общий конвейер импорта, различается только парсер формата.

5. **Visitor** — `IExportVisitor` → `JsonExportVisitor` / `YamlExportVisitor` / `CsvExportVisitor`.  
   *Зачем:* один обход домена, разные форматы выгрузки изолированы.

6. **Proxy** — `Cached*RepositoryProxy`.  
   *Зачем:* кэш поверх реального репозитория (возможность прозрачно ускорить чтение).

7. **Factory** — `BankAccountFactory`, `CategoryFactory`, `OperationFactory`.  
   *Зачем:* централизованное создание + валидация инвариантов при создании.

8. **Strategy** — `IGroupingStrategy`: `ByCategory` / `ByDay` / `ByType`.  
   *Зачем:* взаимозаменяемые алгоритмы группировок в аналитике без `switch`.

_Доп.:_ используются небуквальные, но стандартные архитектурные практики — **Repository**, **Unit of Work**, **DTO**, **Value Object**.

---

## 2) SOLID и GRASP

**S (Single Responsibility).**  
- Доменные сущности (`BankAccount`, `Category`, `Operation`) — только бизнес-состояние и бизнес-методы.  
- Фабрики — только создание с проверками.  
- Репозитории — только доступ к данным.  
- Фасады — только координация сценариев.

**O (Open/Closed).**  
- Импорт/экспорт расширяется добавлением новых `Importer`/`Visitor` без правок существующего кода.  
- Аналитика расширяется новыми `IGroupingStrategy`.

**L (Liskov).**  
- Все реализации репозиториев взаимозаменяемы по их интерфейсам.  
- Любая `IGroupingStrategy` подставляется без поломок.

**I (Interface Segregation).**  
- Раздельные интерфейсы для `BankAccount`/`Category`/`Operation` репозиториев; нет «толстых» общих интерфейсов.

**D (Dependency Inversion).**  
- Высокоуровневые слои зависят от абстракций (репозитории, фабрики, часы, генератор id).  
- Конкретика поставляется через DI в `CompositionRoot`.

**GRASP.**  
- **Controller:** фасады принимают запросы от UI.  
- **Creator:** фабрики создают доменные объекты.  
- **Low Coupling / High Cohesion:** обязанности узкие, связи через интерфейсы.  
- **Pure Fabrication:** репозитории/DTO — технические классы вне доменной модели.  
- **Polymorphism / Protected Variations:** стратегии/визиторы/шаблоны закрывают вариативность.

---

## 3) Архитектура и слои

- **Presentation (CLI).** `InteractiveUi`/меню → вызывает фасады из DI.  
- **Application.** Фасады, команды (`Command`), декораторы (`TimedCommand`), DTO, порты (интерфейсы).  
- **Domain.** Сущности, фабрики, value-objects, бизнес-правила/валидации.  
- **Infrastructure.** In-memory репозитории, прокси-кэш, импорт/экспорт (importers/visitors).  
- **Bootstrap.** `CompositionRoot` — регистрация в `Microsoft.Extensions.DependencyInjection`.

---

## 4) Функциональность

- **Счета/Категории/Операции:** создание/изменение/удаление. Баланс счёта обновляется при операциях.  
- **Аналитика:** суммы доходов/расходов за период, группировки (по категории/дню/типу), разница.  
- **Импорт/Экспорт:** CSV / JSON / YAML (оба направления).  
- **Пересчёт балансов:** сервис пересчитывает баланс счёта из операций.  
- **Статистика времени:** все команды можно запускать через `TimedCommand`.

---

## 5) Как запустить

Program.cs точка входа
